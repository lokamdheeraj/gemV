#include "base/vulnerability/vul_Queue.hh"

QueueVulCalc::QueueVulCalc(int S)
{
sizeofQueue=S;
   // h = new History1[sizeofQueue];
        for(int j = 0; j < sizeofQueue; j++) {
            h[j].incomingTick = -1;
            h[j].LSN = -1;
}
}
QueueVulCalc::~QueueVulCalc()
{
    
       // delete [] histories[0];

 //  delete h;
//delete time;
}

void
QueueVulCalc::vulOnWrite(long lineSeqNum)
{
int j=0;
   for (j=0; j< sizeofQueue; j++)
	if (h[j].LSN == -1)
	{
   h[j].incomingTick = curTick();
   h[j].LSN = lineSeqNum;
  //head++;
   numOfReq++;
	break;
	}

assert (j < sizeofQueue);

assert(numOfReq <= sizeofQueue);
}

void
QueueVulCalc::vulOnDiscard(long lineSeqNum)
{

    bool find=false;
   for (int j=0; j< sizeofQueue; j++)
	if (h[j].LSN == lineSeqNum)
{
            h[j].LSN = -1;
  	    numOfReq--;
	    find = true;
            break;
}
//if (find) std::cout << "we found this in queue: " << lineSeqNum << "\n" ;
assert (find);
}


long
QueueVulCalc::vulOnRead(long lineSeqNum) 
{
    long vul = 0;
    bool find=false;
   for (int j=0; j< sizeofQueue; j++)
	if (h[j].LSN == lineSeqNum)
{
            vul += curTick()-h[j].incomingTick;
            h[j].LSN = -1;
  	    numOfReq--;
	    find = true;
            //head--;
            break;
}
//if (find) std::cout << "we found this in queue: " << lineSeqNum << "\n" ;
assert (find);
    return vul;
}





